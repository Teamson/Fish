{"version":3,"sources":["assets\\Scripts\\Libs\\TimeCountMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlayerDataMgr from \"./PlayerDataMgr\"\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TimeCountMgr extends cc.Component {\r\n\r\n    public static Share: TimeCountMgr\r\n\r\n    tCount: number = 0\r\n\r\n    onLoad() {\r\n        TimeCountMgr.Share = this\r\n        cc.game.addPersistRootNode(this.node)\r\n        this.init()\r\n    }\r\n\r\n    init() {\r\n        if (localStorage.getItem('powerTime')) {\r\n            this.tCount = parseInt(localStorage.getItem('powerTime'))\r\n        } else {\r\n            localStorage.setItem('power', '0')\r\n        }\r\n\r\n        this.calculateExitTime()\r\n\r\n        if (CC_WECHATGAME) {\r\n            window[\"wx\"].onShow((para) => {\r\n                this.calculateExitTime()\r\n            })\r\n            window[\"wx\"].onHide((para) => {\r\n                localStorage.setItem('powerTime', this.tCount.toString())\r\n                localStorage.setItem('exitTime', new Date().getTime().toString())\r\n            })\r\n        }\r\n\r\n        this.schedule(this.calculateExitTime)\r\n    }\r\n\r\n    calculateExitTime() {\r\n        let exitTime: number = 0\r\n        if (localStorage.getItem('exitTime')) {\r\n            exitTime = new Date().getTime() - parseInt(localStorage.getItem('exitTime'))\r\n        }\r\n\r\n        if (exitTime <= 0) return\r\n\r\n        exitTime /= 1000\r\n        let t = Math.floor(exitTime / 600)\r\n        PlayerDataMgr.getPlayerData().power += t\r\n        if (PlayerDataMgr.getPlayerData().power > 10) {\r\n            PlayerDataMgr.getPlayerData().power = 10\r\n            PlayerDataMgr.setPlayerData()\r\n        }\r\n    }\r\n\r\n    calculateTime() {\r\n        if (this.tCount <= 0) {\r\n            if (PlayerDataMgr.getPlayerData().power < 10) {\r\n                this.tCount = 600\r\n            } else {\r\n                this.tCount = 0\r\n            }\r\n            return\r\n        }\r\n        this.tCount--\r\n\r\n        if (this.tCount <= 0) {\r\n            if (PlayerDataMgr.getPlayerData().power < 10) {\r\n                PlayerDataMgr.getPlayerData().power += 1\r\n                PlayerDataMgr.setPlayerData()\r\n                this.tCount = PlayerDataMgr.getPlayerData().power < 10 ? 600 : 0\r\n            }\r\n        }\r\n    }\r\n\r\n}"]}