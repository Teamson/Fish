{"version":3,"sources":["assets\\Scripts\\Mod\\AdMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Utility from \"./Utility\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport ShareMgr from \"./ShareMgr\";\r\nimport JJMgr, { ExportDir } from \"../../ExportLibs/ExportUtils\";\r\n\r\nexport default class AdMgr {\r\n    private static _instance: AdMgr\r\n    public static get instance(): AdMgr {\r\n        if (!this._instance) {\r\n            this._instance = new AdMgr()\r\n        }\r\n        return this._instance\r\n    }\r\n\r\n    private bannerUnitId: string[] = ['adunit-8ceebcafa271d4d2', 'adunit-28f839dc57be0edd']\r\n    private videoUnitId: string = 'adunit-43095a0d9b35d115'\r\n    private bannerAd: any = null\r\n    private videoAd: any = null\r\n    public videoCallback: Function = null\r\n    public videoCloseCallback: Function = null\r\n    private curBannerId: number = 0\r\n    public showBannerCount: number = 0\r\n\r\n    public videoIsError: boolean = true\r\n    private videoLoaded: boolean = false\r\n    public isBannerError: boolean = true\r\n\r\n    initAd() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            this.initBanner()\r\n            this.initVideo()\r\n        }\r\n    }\r\n\r\n    //初始化banner\r\n    initBanner() {\r\n        this.isBannerError = false\r\n        //适配iphoneX\r\n        let isIphonex = false\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            window[\"wx\"].getSystemInfo({\r\n                success: res => {\r\n                    let modelmes = res.model\r\n                    if (modelmes.search('iPhone X') != -1) {\r\n                        isIphonex = true\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        let winSize = window[\"wx\"].getSystemInfoSync()\r\n\r\n        //初始化banner\r\n        this.bannerAd = window[\"wx\"].createBannerAd({\r\n            adUnitId: this.bannerUnitId[this.curBannerId],\r\n            style: {\r\n                left: 0,\r\n                top: 0,\r\n                width: 0,\r\n                height: 300\r\n            }\r\n        })\r\n        //监听banner尺寸修正\r\n        this.bannerAd.onResize(res => {\r\n            if (isIphonex) {\r\n                this.bannerAd.style.top = winSize.windowHeight - this.bannerAd.style.realHeight - 10\r\n            } else {\r\n                this.bannerAd.style.top = winSize.windowHeight - this.bannerAd.style.realHeight\r\n            }\r\n            this.bannerAd.style.left = winSize.windowWidth / 2 - this.bannerAd.style.realWidth / 2\r\n        })\r\n\r\n        this.bannerAd.onError(res => {\r\n            // 错误事件\r\n            console.log('banner error:', JSON.stringify(res))\r\n            this.isBannerError = true\r\n        })\r\n    }\r\n    //隐藏banner\r\n    hideBanner() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME && this.bannerAd) {\r\n            if (this.isBannerError) {\r\n                JJMgr.instance.closeExportUI(ExportDir.VIEW_SCROLLUI)\r\n            } else {\r\n                this.bannerAd.hide()\r\n\r\n                if (JJMgr.instance.exportCfg != null && this.showBannerCount >= parseInt(JJMgr.instance.exportCfg.front_banner_number)) {\r\n                    this.showBannerCount = 0\r\n                    this.curBannerId++\r\n                    if (this.curBannerId >= this.bannerUnitId.length) {\r\n                        this.curBannerId = 0\r\n                    }\r\n\r\n                    console.log('destroy banner')\r\n                    this.bannerAd.destroy()\r\n                    this.bannerAd = null\r\n                    this.initBanner()\r\n                }\r\n            }\r\n        } else {\r\n            JJMgr.instance.closeExportUI(ExportDir.VIEW_SCROLLUI)\r\n        }\r\n    }\r\n\r\n    // countBanner() {\r\n    //     if (JJMgr.instance.dataConfig != null && this.showBannerCount > parseInt(JJMgr.instance.dataConfig.front_banner_number)) {\r\n    //         this.bannerAd.hide()\r\n    //         this.showBannerCount = 0\r\n    //         this.curBannerId++\r\n    //         if (this.curBannerId >= this.bannerUnitId.length) {\r\n    //             this.curBannerId = 0\r\n    //         }\r\n\r\n    //         console.log('destroy banner')\r\n    //         this.bannerAd.destroy()\r\n    //         this.bannerAd = null\r\n    //         this.initBanner()\r\n    //         this.showBanner()\r\n    //     }\r\n    // }\r\n\r\n    //显示banner\r\n    showBanner() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME && this.bannerAd) {\r\n            this.showBannerCount++\r\n            if (this.isBannerError && !WxApi.isKillBossUI) {\r\n                JJMgr.instance.showExportUI(ExportDir.VIEW_SCROLLUI)\r\n            } else {\r\n                this.bannerAd.show()\r\n            }\r\n        } else {\r\n            JJMgr.instance.showExportUI(ExportDir.VIEW_SCROLLUI)\r\n        }\r\n    }\r\n    //销毁banner\r\n    destroyBanner() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME && this.bannerAd) {\r\n            this.bannerAd.destroy()\r\n            this.bannerAd = null\r\n        }\r\n    }\r\n\r\n    initVideo() {\r\n        if (cc.sys.platform !== cc.sys.WECHAT_GAME) {\r\n            return\r\n        }\r\n        //初始化视频\r\n        if (!this.videoAd) {\r\n            this.videoAd = window[\"wx\"].createRewardedVideoAd({\r\n                adUnitId: this.videoUnitId\r\n            })\r\n        }\r\n\r\n        this.loadVideo()\r\n        this.videoAd.onLoad(() => {\r\n            console.log('激励视频加载成功')\r\n            this.videoLoaded = true\r\n        })\r\n        //视频加载出错\r\n        this.videoAd.onError(res => {\r\n            console.log('video Error:', JSON.stringify(res))\r\n            this.videoIsError = true\r\n        })\r\n    }\r\n\r\n    loadVideo() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME && this.videoAd != null) {\r\n            this.videoIsError = false\r\n            this.videoAd.load()\r\n        }\r\n    }\r\n\r\n    //初始化激励视频\r\n    showVideo(cb: Function) {\r\n        this.videoCallback = cb\r\n        if (cc.sys.platform !== cc.sys.WECHAT_GAME) {\r\n            this.videoCallback()\r\n            this.videoCloseCallback && this.videoCloseCallback()\r\n            this.videoCloseCallback = null\r\n            return\r\n        }\r\n\r\n        if (this.videoIsError) {\r\n            ShareMgr.instance.shareGame(cb)\r\n            this.loadVideo()\r\n            return\r\n        }\r\n\r\n        if (this.videoLoaded == false) {\r\n            WxApi.OpenAlert('视频正在加载中！')\r\n            return\r\n        }\r\n\r\n        if (this.videoAd) {\r\n            this.videoAd.offClose()\r\n        }\r\n        //关闭声音\r\n\r\n        //监听关闭视频\r\n        this.videoAd.onClose(res => {\r\n            if (res && res.isEnded || res === undefined) {\r\n                console.log('正常播放结束，可以下发游戏奖励')\r\n                this.videoCallback()\r\n            }\r\n            else {\r\n                console.log('播放中途退出，不下发游戏奖励')\r\n            }\r\n            this.videoCloseCallback && this.videoCloseCallback()\r\n            this.videoCloseCallback = null\r\n            //恢复声音\r\n\r\n            this.videoLoaded = false\r\n            this.loadVideo()\r\n        })\r\n\r\n        this.videoAd.show()\r\n    }\r\n\r\n}"]}