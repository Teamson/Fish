{"version":3,"sources":["assets\\Scripts\\Mod\\ShareMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport AdMgr from \"./AdMgr\"\r\nimport WxApi from \"../Libs/WxApi\"\r\nimport JJMgr from \"../../ExportLibs/ExportUtils\"\r\n\r\n\r\nexport default class ShareMgr {\r\n    private static _instance: ShareMgr\r\n    public static get instance(): ShareMgr {\r\n        if (!this._instance) {\r\n            this._instance = new ShareMgr()\r\n        }\r\n        return this._instance\r\n    }\r\n\r\n    private path: string = ''\r\n    private picCount: number = 3\r\n\r\n    private preT: number = 0\r\n\r\n    shareTips: string[] = [\r\n        '请分享到活跃的群！',\r\n        '请分享到不同群！',\r\n        '请分享给好友！',\r\n        '请分享给20人以上的群！']\r\n\r\n    //初始化分享  \r\n    initShare() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            //开启右上角的分享\r\n            window[\"wx\"].showShareMenu({\r\n                withShareTicket: true,\r\n                menus: ['shareAppMessage', 'shareTimeline']\r\n            });\r\n\r\n            let dir = JJMgr.instance.exportCfg.front_share_config.image\r\n            let content = JJMgr.instance.exportCfg.front_share_config.title\r\n            window[\"wx\"].onShareAppMessage(function (res) {\r\n                return {\r\n                    title: content,\r\n                    imageUrl: dir,\r\n                }\r\n            })\r\n            // cc.loader.loadRes(dir, function (err, data) {\r\n            //     window[\"wx\"].onShareAppMessage(function (res) {\r\n            //         return {\r\n            //             title: content,\r\n            //             imageUrl: data.url,\r\n            //         }\r\n            //     })\r\n            // });\r\n\r\n            window[\"wx\"].onShow((para) => {\r\n                if (WxApi.shareCallback) {\r\n                    let t = new Date().getTime()\r\n                    let diff = t - WxApi.shareTime\r\n                    if (diff / 1000 >= 3 && !WxApi.firstShare) {\r\n                        WxApi.shareCallback()\r\n                        WxApi.front_share_number--\r\n                        window[\"wx\"].showToast({\r\n                            title: '分享成功',\r\n                            icon: 'none',\r\n                            duration: 2000\r\n                        })\r\n                        WxApi.shareCallback = null\r\n                    } else {\r\n                        WxApi.firstShare = false\r\n                        window[\"wx\"].showModal({\r\n                            title: '提示',\r\n                            content: this.shareTips[Math.floor(Math.random() * this.shareTips.length)],\r\n                            confirmText: '重新分享',\r\n                            success(res) {\r\n                                if (res.confirm) {\r\n                                    console.log('用户点击确定')\r\n                                    ShareMgr.instance.shareGame(WxApi.shareCallback)\r\n                                } else if (res.cancel) {\r\n                                    console.log('用户点击取消')\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    shareGame(cb: Function) {\r\n        // if (WxApi.front_share_number <= 0) {\r\n        //     AdMgr.instance.showVideo(cb)\r\n        //     return\r\n        // }\r\n\r\n        WxApi.shareCallback = cb\r\n        if (cc.sys.platform !== cc.sys.WECHAT_GAME) {\r\n            cb();\r\n            return;\r\n        }\r\n        WxApi.shareTime = new Date().getTime()\r\n        let dir = JJMgr.instance.exportCfg.front_share_config.image\r\n        let content = JJMgr.instance.exportCfg.front_share_config.title\r\n        window[\"wx\"].shareAppMessage({\r\n            title: content,\r\n            imageUrl: dir\r\n        })\r\n        // cc.loader.loadRes(dir, (err, data) => {\r\n        //     window[\"wx\"].shareAppMessage({\r\n        //         title: content,\r\n        //         imageUrl: data.url\r\n        //     })\r\n        // });\r\n    }\r\n\r\n}"]}