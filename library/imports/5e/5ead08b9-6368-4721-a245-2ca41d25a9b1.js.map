{"version":3,"sources":["assets\\Scripts\\Crl\\Prop\\Stone.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6CAAwC;AACxC,gDAA2C;AAGrC,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAA0B,CAAC;AAG5C;IAAmC,yBAAY;IAD/C;QAAA,qEAiEC;QA5DG,aAAO,GAAW,CAAC,CAAA;QAGnB,cAAQ,GAAW,CAAC,CAAA;QAEpB,gBAAU,GAAY,IAAI,CAAA;QAE1B,eAAS,GAAY,KAAK,CAAA;QAC1B,iBAAW,GAAY,KAAK,CAAA;;IAoDhC,CAAC;cAhEoB,KAAK;IActB,sBAAM,GAAN;QACI,OAAK,CAAC,KAAK,GAAG,IAAI,CAAA;QAClB,IAAI,CAAC,UAAU,GAAG,mBAAS,CAAC,KAAK,CAAC,UAAU,CAAA;IAChD,CAAC;IAED,qBAAK,GAAL;IAEA,CAAC;IAED,MAAM;IACN,yBAAS,GAAT;QAAA,iBAYC;QAXG,OAAO,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,EAAE;YACtB,KAAI,CAAC,SAAS,GAAG,IAAI,CAAA;YACrB,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,KAAI,CAAC,QAAQ,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,KAAI,CAAC,OAAO,CAAC,CAAC,CAAA;YACzD,IAAI,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC;gBACjB,KAAI,CAAC,SAAS,GAAG,KAAK,CAAA;gBACtB,KAAI,CAAC,WAAW,GAAG,IAAI,CAAA;gBACvB,EAAE,EAAE,CAAA;YACR,CAAC,CAAC,CAAA;YACF,IAAI,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;YAC5B,KAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAA;QAC3B,CAAC,CAAC,CAAA;IACN,CAAC;IAED,WAAW;IACX,4BAAY,GAAZ;QACI,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,GAAG,GAAG,iBAAO,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;YACzD,IAAI,GAAG,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;gBAC9B,IAAI,CAAC,UAAU,CAAC,cAAc,EAAE,CAAA;gBAChC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAA;gBACnB,mBAAS,CAAC,KAAK,CAAC,MAAM,EAAE,CAAA;aAC3B;SACJ;IACL,CAAC;IAED,2BAAW,GAAX;QACI,IAAI,mBAAS,CAAC,KAAK,CAAC,KAAK,IAAI,mBAAS,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE;YACxD,IAAI,GAAG,GAAG,iBAAO,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,mBAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;YAC/D,IAAI,GAAG,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;gBAC9B,mBAAS,CAAC,KAAK,CAAC,KAAK,CAAC,cAAc,EAAE,CAAA;gBACtC,mBAAS,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,CAAA;aAClC;SACJ;IACL,CAAC;IAED,sBAAM,GAAN,UAAO,EAAE;QACL,IAAI,CAAC,YAAY,EAAE,CAAA;QACnB,IAAI,CAAC,WAAW,EAAE,CAAA;IACtB,CAAC;;IA3DD;QADC,QAAQ;0CACU;IAGnB;QADC,QAAQ;2CACW;IAPH,KAAK;QADzB,OAAO;OACa,KAAK,CAgEzB;IAAD,YAAC;CAhED,AAgEC,CAhEkC,EAAE,CAAC,SAAS,GAgE9C;kBAhEoB,KAAK","file":"","sourceRoot":"/","sourcesContent":["import Utility from \"../../Mod/Utility\";\r\nimport LevelBase from \"../Level/LevelBase\";\r\nimport Player from \"../Player\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Stone extends cc.Component {\r\n    public static Share: Stone\r\n\r\n    @property\r\n    moveByY: number = 0\r\n\r\n    @property\r\n    moveTime: number = 1\r\n\r\n    playerNode: cc.Node = null\r\n\r\n    isMoveing: boolean = false\r\n    isTriggered: boolean = false\r\n\r\n    onLoad() {\r\n        Stone.Share = this\r\n        this.playerNode = LevelBase.Share.playerNode\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    //触发事件\r\n    triggerCB() {\r\n        return new Promise((rs, rj) => {\r\n            this.isMoveing = true\r\n            let a1 = cc.moveBy(this.moveTime, cc.v2(0, this.moveByY))\r\n            let a2 = cc.callFunc(() => {\r\n                this.isMoveing = false\r\n                this.isTriggered = true\r\n                rs()\r\n            })\r\n            let a3 = cc.sequence(a1, a2)\r\n            this.node.runAction(a3)\r\n        })\r\n    }\r\n\r\n    //检测是否碰到美人鱼\r\n    collByPlayer() {\r\n        if (this.playerNode) {\r\n            let dis = Utility.getWorldDis(this.node, this.playerNode)\r\n            if (dis <= 20 && !this.isMoveing) {\r\n                this.playerNode.stopAllActions()\r\n                this.node.destroy()\r\n                LevelBase.Share.loseCB()\r\n            }\r\n        }\r\n    }\r\n\r\n    collBySharp() {\r\n        if (LevelBase.Share.Sharp && LevelBase.Share.Sharp.isValid) {\r\n            let dis = Utility.getWorldDis(this.node, LevelBase.Share.Sharp)\r\n            if (dis <= 50 && !this.isMoveing) {\r\n                LevelBase.Share.Sharp.stopAllActions()\r\n                LevelBase.Share.Sharp.destroy()\r\n            }\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        this.collByPlayer()\r\n        this.collBySharp()\r\n    }\r\n}\r\n"]}